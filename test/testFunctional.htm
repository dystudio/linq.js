<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>linq.js test:Action</title>
    <script type="text/javascript" src="../jsunit/app/jsUnitCore.js"></script>
    <script type="text/javascript" src="../linq.js"></script>
</head>
<body>
    <!-- This file is linq.js test for JsUnit -->
    <script type="text/javascript">
        function testLet()
        {
            var sum = Enumerable.Range(1, 10).Let(function (e)
            {
                return e.Zip(e, function (a, b) { return { a: a, b: b} });
            })
            .Select("$.a + $.b")
            .Sum();

            assertEquals(110, sum);
        }

        function testShare()
        {
            var share = Enumerable.Range(1, 10).Share();
            var ar1 = share.Take(4).ToArray();
            var ar2 = share.ToArray();
            var ar3 = share.ToArray();
            assertArrayEquals([1, 2, 3, 4], ar1);
            assertArrayEquals([5, 6, 7, 8, 9, 10], ar2);
            assertArrayEquals([], ar3);
        }

        function testMemoizeAll()
        {
            var count = 0;
            var mem = Enumerable.Range(1, 5)
                .Select(function (x) { count++; return x; })
                .MemoizeAll();
            var ar1 = mem.ToArray();
            var ar2 = mem.ToArray();
            assertArrayEquals([1, 2, 3, 4, 5], ar1);
            assertArrayEquals([1, 2, 3, 4, 5], ar2);
            assertEquals(5, count);
        }

    </script>
</body>
</html>
